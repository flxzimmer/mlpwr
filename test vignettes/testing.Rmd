---
title: "testing"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r}
library(simpackage)
```


# Implemented Features

### minimum working example

```{r include=FALSE}
set.seed(1)
```


```{r}
dgfun = example.dgf("ttest")

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000
  )
summary(ds)
plot(ds)
```


### different surrogates 1D  

```{r include=FALSE}
set.seed(1)
```

```{r}
dgfun = example.dgf("ttest")

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000,
  surrogate="reg"
)
summary(ds)


ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000,
  surrogate="gpr"
)
summary(ds)


ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000,
  surrogate="svr"
)
summary(ds)
```

### 2D: different surrogates and tasks                     
```{r include=FALSE}
set.seed(1)
```


```{r}
dgfun = example.dgf("anova")
costfun = function(x) x[1]*1.9+x[2]*6


# desired power task

ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  power = .8,
  runs = 4000)
summary(ds)


ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  power = .8,
  runs = 4000,
  surrogate="svr"
  )
summary(ds)
```

cost threshold task
```{r}

ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  max_cost = 174,
  runs = 4000
)
summary(ds)


ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  max_cost = 174,
  runs = 4000,
  surrogate="svr"
)
summary(ds)



```


### different terminations

```{r include=FALSE}
set.seed(1)
```

```{r}
dgfun = example.dgf("ttest")

# runs

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000)
summary(ds)
```

Termination by width of a 95% confidence interval calculated using the SE. Uses GPR surrogate model to make use of the SE that is estimated each update.
```{r}
# ci

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  ci = .03,
  surrogate = "gpr")
summary(ds)
```

Termination by time. 
```{r}
# time

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  time = 5)
summary(ds)


# multiple

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs= 1000,
  ci = .03,
  time = 5,
  surrogate = "gpr"
)
summary(ds)
```


### continue a search

```{r include=FALSE}
set.seed(1)
```

 
```{r}
dgfun = example.dgf("ttest")

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000
)
summary(ds)

ds_continued = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000,
  dat=ds$dat
)

summary(ds_continued)
```

### wrong boundaries   

```{r include=FALSE}
set.seed(1)
```

restart search because of wrong boundaries

```{r}
dgfun = example.dgf("ttest",delta=.2)

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000
)
summary(ds)
plot(ds)

# adjusted

ds = find.design(
  dgfun = dgfun,
  boundaries = c(200,500),
  power = .8,
  runs = 2000
)
summary(ds)
plot(ds)
```


cost threshold task in 2D

this is much harder to detect since the combinations on the edge don't necessarily fulfill the cost threshold well

```{r}

dgfun = example.dgf("anova")
costfun = function(x) x[1]*1.9+x[2]*6

ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,40),k=c(5,25)),
  costfun = costfun,
  max_cost = 174,
  runs = 8000
)
summary(ds)
plot(ds)


# adjusted borders

ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  max_cost = 174,
  runs = 8000
)
summary(ds)
plot(ds)
```

### plot options 1D      

```{r include=FALSE}
set.seed(1)
```


```{r}
# 1D Plot

dgfun = example.dgf("ttest")

ds1 = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000
)
summary(ds1)
plot(ds1)
plot(ds1,adderrorbars = T)


# 1D plot with multidimensional dgf

dgfun = example.dgf("anova")
costfun = function(x) x[1]*1.9+x[2]*6

ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  power = .8,
  runs = 4000)
summary(ds)

plot(ds,design=list(n=NA,k=9))
plot(ds,design=list(n=NA,k=10))
```


### plot options 2D      

```{r include=FALSE}
set.seed(1)
```

2D Plot after desired Power Task

```{r}
dgfun = example.dgf("anova")
costfun = function(x) x[1]*1.9+x[2]*6

ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  power = .8,
  runs = 4000)

plot(ds)
```


2D Plot after cost threshold task
```{r}
ds = find.design(
  dgfun = dgfun,
  boundaries = list(n = c(20,90),k=c(5,25)),
  costfun = costfun,
  max_cost = 174,
  runs = 4000
)

plot(ds)
```




### autosaving          

```{r include=FALSE}
set.seed(1)
```

```{r}
dgfun = example.dgf("ttest")

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000,
  autosave_dir = "C:/Users/admin/switchdrive/4 irt/"
)
summary(ds)
```



### setting surrogate model hyperparameters

```{r include=FALSE}
set.seed(1)
```

Example: changing the covariance function for the gpr


```{r}
dgfun = example.dgf("ttest")

ds = find.design(
  dgfun = dgfun,
  boundaries = c(50,200),
  power = .8,
  runs = 2000,
  surrogate = "gpr",
  control = list(covtype="gauss")
  )
summary(ds)
plot(ds)
```



