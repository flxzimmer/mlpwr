---
title: "paper code"
output: html_document
---

# Toy Example

```{r}
set.seed(1)
```


```{r}
simfun = function(N) {
    data = rnorm(n = N, mean = .3) 
    pvalue = t.test(data)$p.value
    pvalue < .01
}
simulations = replicate(500,simfun(N = 70))
estimated_power = mean(simulations)
estimated_power
```

```{r}
library(mlpwr)
res = find.design(dgfun = simfun,
    boundaries = c(50,200), power = .8)
summary(res)
```

```{r}
plot(res)
```


# Example 1
```{r}
set.seed(1)
```

```{r}
library(mirt)
```

```{r}
  a1 = a2 = matrix(abs(rnorm(10,1,.3)), ncol=1)
  d1 = d2 = matrix(rnorm(10,0,.7),ncol=1)
  a2[1:2, ] = a1[1:2, ]/3
  d1[c(1,3), ] = d2[c(1,3), ]/4
  itemtype = rep('2PL', nrow(a1))

simfun_irt = function(N) {
  dataset1 = simdata(a1, d1, N, itemtype)
  dataset2 = simdata(a2, d2, N, itemtype, mu = .1, sigma = matrix(1.5))
  dat = rbind(dataset1, dataset2)
  group = c(rep('D1', N), rep('D2', N))
  model = multipleGroup(dat, 1, group, SE = TRUE)
  res = DIF(model, c('a1', 'd'))
  sig = res$p<.05
  all(sig[1:2])
}

simfun_irt = function(N) {
    data = rnorm(n = N, mean = .3) 
    pvalue = t.test(data)$p.value
    pvalue < .01
}

```


```{r}
res = find.design(dgfun = simfun_irt,
    boundaries = c(50,200), power = .8,runs = 1000)
summary(res)
```


```{r}
res2 = find.design(continue = res, runs = 2000)
summary(res2)
```


```{r}
plot(res2)
```

