---
title: "archive"
output: html_document
---


# Old Stuff

## Basic Workflow

The basic worklow is illustrated with testing a 2PL in the Rasch Model with an Andersen LR Test.


```{r message=FALSE, warning=FALSE}

model <- setup.model(architecture = "Rasch", n.items= 20, beta = rnorm(20), pers.dist = "normal")

altmodel <- setup.alternative(class="2PL")

test1 <- setup.test(type = "AndersenLR")

power(model = model, altmodel=altmodel, test = test1, effect.size = .01,alpha = .05, n.pers=100,runs=5)

```

Testing for DIF with the M2 Test

```{r message=FALSE, warning=FALSE}

model <- setup.model(architecture = "Rasch", n.items= 20, beta = rnorm(20), pers.dist = "normal")

altmodel <- setup.alternative(class="DIF")

test1 <- setup.test(type = "M2")

power(model = model, altmodel=altmodel, test = test1, effect.size = .02,alpha = .05, n.pers=100,runs=5)

```

Single Item DIF: 2PL Baseline, DIF on a single item, Wald Test)

```{r message=FALSE, warning=FALSE}

model <- setup.model(architecture = "2PL", n.items= 20, alpha = rlnorm(n=20,sdlog=.05), beta = rnorm(20), pers.dist = "normal")

altmodel <- setup.alternative(class="DIF",diftype=1)

test1 <- setup.test(type = "Wald",waldtype = "single")

power(model = model, altmodel=altmodel, test = test1, effect.size = .02,alpha = .05, n.pers=100,runs=5)

```

DIF in some items

```{r message=FALSE, warning=FALSE}

model <- setup.model(architecture = "2PL", n.items= 20, alpha = rlnorm(n=20,sdlog=.05), beta = rnorm(20), pers.dist = "normal")

altmodel <- setup.alternative(class="DIF",diftype=5)

test1 <- setup.test(type = "Wald",waldtype = "any")

power(model = model, altmodel=altmodel, test = test1, effect.size = .02,alpha = .05, n.pers=100,runs=5)

```




## mirt package

The available tests are:
* M2

Example: M2

```{r}
dat <- expand.table(LSAT7)
mirtfit <- mirt(dat,1,verbose = FALSE)
re = M2(mirtfit)
re
```

Power against a 2PL? Required Sample Size for a power of .8?

```{r}
model.alt <- mirt(dat,1,itemtype = "2PL",verbose = FALSE)

runfun = function(model,n) {

  pars = coef(model,simplify=TRUE)
  data = simdata(pars$items[,1],pars$items[,2],N=n,itemtype = "2PL")
  re = M2(mirt(data,1,verbose=FALSE))$p 
  
  return(re)
}

sim_power(model = model.alt, runfun = runfun, n.pers = 500, n.runs=10)
sim_samplesize(model = model.alt, runfun = runfun, power=.5, max.runs=100, tol =.05)
```


## eRm package

The available tests are:
* Andersen LR


Example: Andersen LR

```{r}
dat = raschdat1
ermfit = RM(dat)
re = LRtest(ermfit)
re
```

Power against a 2PL?

```{r}
model.alt <- mirt(dat,1,itemtype = "2PL",verbose = FALSE)

datafun = function(model,n) {
  
  model = model@Model
  pars = coef(model.alt,simplify=TRUE)
  data = mirt::simdata(pars$items[,1],pars$items[,2],N=n,itemtype = model$itemtype)

  return(data)
}

testfun = function(data) LRtest(RM(data))$pvalue 

sim_power(model = model.alt, datafun = datafun, testfun = testfun,n.pers = 500, n.runs=10)
sim_samplesize(model = model.alt, datafun = datafun, testfun = testfun, power=.5, max.runs=100, tol =.05)


```


## TAM package

The available tests are:
* Q3

Example: Q3

```{r}
dat = data.cqc01
tamfit = tam(dat,verbose=FALSE)
re = tam.modelfit(tamfit,progress=FALSE)$stat.MADaQ3
re
```

Power against a 2PL?

```{r}
model.alt <- mirt(dat,1,itemtype = "2PL",verbose = FALSE)
testfun = function(data) tam.modelfit(tam(data,verbose=FALSE),progress=FALSE)$stat.MADaQ3$p 
sim_power(model.alt, testfun,n.runs=50)
```


##Psychotools package
(to be extended)

The available tests are:
* Q3

Example: Q3

```{r}
data("VerbalAggression", package = "psychotools")
dat = VerbalAggression$resp2
# psychofit = raschtree(dat)
```




